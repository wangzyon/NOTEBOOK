# 1 编译原理

## 1.1 C++内存模型 

#### 虚拟地址空间

linux系统中一个进程中会分配4G（2^32）虚拟地址空间，可执行文件运行时，符号表虚拟地址映射到进程的虚拟地址空间，CPU通过内存管理单元（MMU）关联虚拟内存和物理内存；

#### 用户空间和内核空间

![](images/用户空间和内核空间.svg)


```cpp
/*
.data    :数据段，存放初始化后，且初始化不为0的数据；
.rodata  :只读数据段；常量字符串；
.text    :已编译程序的机器码；
.bss     :数据段存放未初始化 或初始化为0的数据；.bss数据会被内核置为0，因此全局变量未初始化会是0，而局部变量未初始化值不定；
.heap    :堆内存；
.dll/.so :链接库；
stack    :栈空间；从高地址向低地址增长；
命令行参数和环境变量
*/

int gdata1 = 10;   // 全局变量，已初始化，存放在.data数据段
int gdata2 = 0;    //全局变量，初始化为0，存放在.bss数据段
extern int gdata3; //全局变量，由于是引用，其符号类型是*UND*，undefine未定义，表示引用

static int gdata4 = 11; //静态变量，已初始化，存放在.data数据段
static int gdata5 = 0;  //静态变量，初始化为0，存放在.bss数据段
static int gdata6;      //静态变量，未初始化，存放在.bss数据段

int main() //全局函数，存放在.text段
{
    int a = 12;
    int b = 0;
    int c; //局部变量在编译时，是以指令形式存在.text段，但在运行条指令时，将在栈上开辟栈帧，在stack上；

    static int e = 13; //静态变量，已初始化，存放在.data数据段
    static int f = 0;  //静态变量，初始化为0，存放在.bss数据段
    static int g;      //静态变量，未初始化，存放在.bss数据段
}
```

用户空间是私有的，因此进程间不能直接进行通信；内核空间是共享的，因此，可以通过在内核空间开辟一块内存，作为匿名管道，实现进程间通信。